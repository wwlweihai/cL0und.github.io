<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="常乐村伪基站"><title>记录xss挑战赛14题解题过程 | cL0und</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">记录xss挑战赛14题解题过程</h1><a id="logo" href="/.">cL0und</a><p class="description">How can I to be an interesting web dog</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">记录xss挑战赛14题解题过程</h1><div class="post-meta">Sep 1, 2017</div><div class="post-content"><p>只思考了这道题，然后就陷进去了。先来看题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">header(&apos;X-XSS-Protection:0&apos;);</div><div class="line">header(&apos;Content-Type:text/html;charset=utf-8&apos;);</div><div class="line">?&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=10&quot;&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;form action=&apos;&apos;&gt;</div><div class="line">&lt;input type=&apos;hidden&apos; name=&apos;token&apos; value=&apos;&lt;?php</div><div class="line">  echo htmlspecialchars($_GET[&apos;token&apos;]); ?&gt;&apos;&gt;</div><div class="line">&lt;input type=&apos;submit&apos;&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>考点是输出点出现在input hidden框里面，因为文本框被隐藏一般的和点击有关的事件（如 onfocus）就不会被触发了。</p>
<p>传统的解法大概有三种</p>
<p>第一种：IE6下用css的expression属性触发</p>
<p>第二种：firefox用accesskey=”X” onclick=alert(),然后shift+alt+x 触发</p>
<p>第三种：如果输入点在<code>type=hidden</code>前可以用另外一个type如<code>type=text</code>将<code>type=hidden</code>覆盖掉（这道题不行）</p>
<p>显然传统的办法肯定不会通过的（规则是：需要最新浏览器，不需要交互）</p>
<p>然后我就开始了漫漫的踩坑路。因为源码中有<code>&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=10&quot;&gt;</code>所以我认为xss是在IE下触发.然后打开<a href="https://msdn.microsoft.com/zh-cn/library/ms535835(v=vs.85" target="_blank" rel="external">input=hidden的官方手册</a>.aspx)惊喜的发现<code>input hidden</code>下还有on*事件</p>
<p> <img src="捕获.PNG" alt=""></p>
<p>然后百度了一下用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">onbeforedeactivate	</div><div class="line">Fires immediately before the activeElement is changed from the current object to another object in the parent document.</div><div class="line">在 activeElement 从当前对象变为父文档其它对象之前立即触发。不懂~</div><div class="line"></div><div class="line">ondatasetcomplete	</div><div class="line">Fires to indicate that all data is available from the data source object.</div><div class="line">数据在数据源发生变化时触发的事件，不懂~</div><div class="line"></div><div class="line">oninvalid</div><div class="line">Provides specified alert text if an input element is invalid.</div><div class="line">&lt;input type=&quot;text&quot; oninvalid=&quot;alert(&apos;该项不能空!&apos;);&quot; name=&quot;fname&quot; required&gt;</div><div class="line">&lt;input type=&quot;text&quot; name=&quot;phone&quot; maxlength=&quot;11&quot; pattern=&quot;^(0|86|17951)?1[0-9]&#123;10&#125;&quot; </div><div class="line">    oninvalid=&quot;setCustomValidity(&apos;请输入11位手机号&apos;);&quot;/&gt;</div><div class="line"></div><div class="line"></div><div class="line">onselect</div><div class="line">onselect 事件会在文本框中的文本被选中时发生。	</div><div class="line">Fires when the current selection changes.</div><div class="line"></div><div class="line">onpropertychange</div><div class="line">动态监听输入框值变化的情况，比如value属性的值改变时会触发</div></pre></td></tr></table></figure>
<p>前两个不是很懂什么意思，试了后三个都不行</p>
<p>oninvalid：oninvalid一般情况下必须要配合<code>required</code>或者<code>pattern</code>,可惜的是hidden下均不支持</p>
<p>onselect：显然框都隐藏了，不可能还需要文本，况且需要交互。</p>
<p>onpropertychange：是一个死逻辑，想改变value值就许必须有个js触发点然后用DOM，不过既然都有触法点了谁还会用这个属性（这道题而言）</p>
<p>然后我就蒙蔽了，既然通常情况下都不行，那为什么还会写在<code>input type=hidden</code>下面，黑人问号？？？</p>
<p><img src="捕获3.PNG" alt=""></p>
<p>最后看到了柠檬师傅的正确答案</p>
<p><code>token=&#39; style=behavior:url(x) onreadystatechange=alert(1) &#39;</code></p>
<p>后来查资料发现这是一个IE6~IE10支持的一个css的语法，behavior:url(???)允许调用一个外部的.htc文件来修改HTML的行为和方法（但是受同源策略影响）具体语法可以看<a href="http://www.cnblogs.com/zhwl/archive/2011/02/28/1967176.html" target="_blank" rel="external">这篇文章</a></p>
<p>如果成功就有上传htc文件（可以写更复杂的利用代码而没有长度限制）配合xss这个思路。因为</p>
<p>.htc files are commonly used in .css files using an IE specific property called behavior, using this along with the .htc file allows the browser to run JavaScript code which is whats contained within the file.</p>
<p>下面是是一个利用demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">　　　　&lt;html&gt;</div><div class="line">　　　　&lt;head&gt;</div><div class="line">　　　　　　&lt;style&gt;</div><div class="line">　　　　　　h1 &#123; behavior: url(behave.htc) &#125;</div><div class="line">　　　　　　&lt;/style&gt;</div><div class="line">　　　　&lt;/head&gt;</div><div class="line">　　　　&lt;body&gt;</div><div class="line">　　　　　　&lt;h1&gt;把鼠标放在这里 poluoluo.com&lt;/h1&gt;</div><div class="line">　　　　&lt;/body&gt;</div><div class="line">　　　　&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;component&gt;</div><div class="line">&lt;attach for=&quot;element&quot; event=&quot;onmouseover&quot; handler=&quot;hig_lite&quot; /&gt;</div><div class="line">&lt;attach for=&quot;element&quot; event=&quot;onmouseout&quot; handler=&quot;low_lite&quot; /&gt;</div><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">alert(1);</div><div class="line">function hig_lite()</div><div class="line">&#123;</div><div class="line">　　element.style.color=255</div><div class="line">&#125;</div><div class="line">function low_lite()</div><div class="line">&#123;</div><div class="line">　　element.style.color=0</div><div class="line">&#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/component&gt;</div></pre></td></tr></table></figure>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>如有出错,还请指教</p>
<p>开学快乐！！</p>
</div><div class="tags"><a href="/tags/XSS/">XSS</a></div><div class="post-nav"><a href="/2017/09/27/Xdebug原理及其攻击面复现/" class="pre"></a><a href="/2017/08/20/TP框架3.2缓存漏洞/" class="next">TP框架3.2缓存漏洞</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/代码审计/" style="font-size: 15px;">代码审计</a> <a href="/tags/XSS/" style="font-size: 15px;">XSS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/27/Xdebug原理及其攻击面复现/">Xdebug原理及其攻击面复现</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/01/记录xss挑战赛14题解题过程/">记录xss挑战赛14题解题过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/TP框架3.2缓存漏洞/">TP框架3.2缓存漏洞</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/通过函数重定义绕过xss过滤器/">通过函数重定义绕过xss过滤器(IE)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/hadsky部分用户任意登录/">hadsky部分用户任意登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://l0ca1.me" title="l0ca1" target="_blank">l0ca1</a><ul></ul><a href="http://kaljes.club" title="J3s" target="_blank">J3s</a><ul></ul><a href="http://godot.win" title="Godot" target="_blank">Godot</a><ul></ul><a href="http://hebic.me" title="H''Homaebic" target="_blank">H''Homaebic</a><ul></ul><a href="http://reversing.win" title="7o8v" target="_blank">7o8v</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">cL0und.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>